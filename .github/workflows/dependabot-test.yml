name: Verify Dependabot Version Update (JavaScript)

on:
  pull_request:
    branches:
      - main
    types:
      - opened
      - synchronize

permissions:
  contents: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest  # Use Ubuntu for JavaScript projects
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Verify Node.js version
        run: node -v

      # Restore, Build, and Test generic JavaScript projects
      - name: Install and Test Generic JavaScript Projects
        run: |
          for dir in msal-client-credentials-flow protect-api protect-function-app protected-api-access-protected-api react-spa vanillajs-spa; do
            echo "Processing directory: $dir"
            cd $dir
            npm install
            npm run test || npm test
            cd ..
          done

  build-angular:
    runs-on: ubuntu-latest  # Use Ubuntu for Angular projects
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Verify Node.js version
        run: node -v

      # Restore, Build, and Test Angular projects
      - name: Install and Test Angular Projects
        run: |
          for dir in angular-spa; do
            echo "Processing Angular directory: $dir"
            cd $dir
            npm install
            npx ng test --watch=false  # Run Angular CLI tests
            cd ..
          done

  # dependabot-auto-merge:
  #   runs-on: ubuntu-latest
  #   needs: [build, build-angular]
  #   steps:
  #     - name: Auto-merge Dependabot PR
  #       if: github.event.pull_request.user.login == 'dependabot[bot]'  # Only run on Dependabot PRs
  #       run: |
  #         gh pr merge ${{ github.event.pull_request.number }} --merge --admin --repo ${{ github.repository }}
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # GitHub token for authentication
